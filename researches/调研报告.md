# 调研报告

> **灵活组合的操作系统模块和框架—[ArceOS](https://github.com/rcore-os/arceos)**

## 项目概述

基于组件化设计的思路，用Rust语言的丰富语言特征，设计实现不同功能的独立操作系统内核模块和操作系统框架，可形成不同特征/形态/架构的操作系统内核。让领域操作系统易于定制/开发/复用。

## 项目背景

- 新应用带来的操作系统新需求
  - 偏基础类的机器学习、机密计算，以及偏行业类的自动驾驶、工业机器人等新兴计算机领域，带来了各种不同的新应用需求。例如在智能汽车的控制领域，需要支持非常轻量实时高可靠的嵌入式应用；在智能汽车的智驾领域，需要支持AI加速和及时处理环境大数据的人工智能应用。这几类应用的需求更偏向于安全、可靠地及时响应事件和高效处理数据，对操作系统的功能要求和外设支持要求相对也少了不少。
    - 现有的Linux、Windows等传统通用操作系统不能充分地满足这些需求。对于这类应用，使用庞大的通用操作系统在功能上当然可以满足要求，但会带来性能、安全和可靠性等方面的不足；小型、专用的操作系统则更容易满足这方面的要求。
    - 现有的RTOS等专用系统不能充分地满足这些需求。现有的RTOS主要面向的是传统的嵌入式应用，所以在设计上很简洁，实时性是其考虑的重点。但现有的人工智能应用的复杂性很高，大量人工智能应用在Linux上开发和运行，难以直接运行在RTOS上。如果要运行在RTOS上，需要考虑对AI加速外设的支持，以及对Linux应用的支持，这对很多RTOS而言，有比较大的挑战。
  - 因此，这些领域的开发者希望研发面向特定领域的新型操作系统。然而，操作系统开发工作的复杂性让开发者望而却步。针对这种需求，我们希望让开发操作系统变得像开发应用一样简单和高效。
- **开发组件化的定制操作系统**
  - 开发组件化的定制操作系统是解决这个问题的方案之一。我们认为将来的操作系统不是像现在统治世界的 Linux、Windows 那样庞大而通用，而是各种可以迅速组合形成的，并且功能丰富多彩的组件化定制操作系统，能够快速适配未来多种多样的处理器、加速器、外设和应用需求，在开发的便捷性、性能和安全性等方面优于已有的通用操作系统。但如何设计组件化定制操作系统是一个需要深入思考的挑战性问题。
    - 实际上，传统的Linux、Windows、FreeBSD也采用了模块化/组件化的设计思路，而且支持内核模块的动态加载和卸载；但由于它们把通用性和性能放在第一位，而且采用C/C++编写，各个模块之间的数据访问和函数调用都以紧耦合的方式。这个特性使得这些操作系统的软件不具有重用性，很难被其他操作系统使用。这样，这些操作系统为了实现对各种应用的支持，变得越来越庞大和臃肿。

## 立项依据及前瞻性、重要性分析

- **[Rust](https://www.rust-lang.org/)：适合操作系统开发的新兴编程语言**
- **[ArceOS](https://github.com/rcore-os/arceos)：用Rust编写的实验性模块化操作系统**
  - ArceOS是[rCore-OS](https://rcore-os.cn/)开源操作系统社区的子项目之一，其灵感很大程度上来自Unikraft。

## 相关工作

1. **组件化定制操作系统的历史回顾**
   - 早在二十世纪九十年代，学术界就已经尝试过组件化定制操作系统的想法，如MIT的PDOS课题组提出的[Exokernel](https://pdos.csail.mit.edu/archive/exo/)和剑桥大学等提出的[Nemesis](https://www.cl.cam.ac.uk/research/srg/netos/projects/archive/nemesis/)操作系统是第一轮组件化操作系统的探索。
     - 其特点是通过把操作系统的部分功能以专用库的形式提供给应用程序使用，运行在用户态，以提升系统的整体性能。由于开发的成本过高，而使用领域比较窄，没有在产业界落地。
   - 进入二十一世纪，随着互联网的发展，如何优化云计算和虚拟化成为了新热点，学术界开始了第二轮组件化操作系统的发展。
     - 在2002年，犹它大学计算机科学系FLUX研究组提出了[OSKit](https://www.cs.utah.edu/flux/oskit/)项目，基于C语言设计了34个组件库和一个连接这些组件库的框架来形成不同功能的特定操作系统内核，其目标在于降低操作系统的研发门槛和成本。
     - [MirageOS](https://mirage.io/)是一个基于OCaml语言编写的库操作系统，它构建了安全的，高性能和资源节约型unikernel。代码可以在普通操作系统上开发，然后编译成在Xen或KVM虚拟机管理程序下运行的完全独立的专用单内核。
     - 这一次的探索依然没有被产业界广泛接受。这与编程语言的选择有很大的关系。C语言没有方便的面向对象的能力，也缺失泛型等语言特征，不具有广泛的重用性，难以形成可被广泛重用的组件。而OCaml语言的抽象能力很强，安全性也很好，但它具有主流函数式语言的通病，相对于C语言，其通用性很弱，而性能更差，缺少对已有应用的支持。
   - 2018年，Rice大学提出了基于Rust语言的[Theseus](https://github.com/theseus-os/Theseus)操作系统，通过精心设计的内核组件，支持操作系统的组件在线更新，使得操作系统的可靠性得到很大增强。但由于过于注重高可靠设计，在性能和已有应用的支持比较差。
   - 2014年以后，学术界意识到如果要得到产业界的认可，需要支持在性能和应用支持上突破，这方面的代表是多家单位合作设计的[Unikraft](https://github.com/unikraft/unikraft)操作系统。
     - Unikraft是一个快速，安全和开源的unikernel开发工具包，采用C语言编写，由不同的组件库构成，支持云计算环境中的常用Linux应用。由于其unikernel架构设计，Unikraft可以根据应用程序的特定需求定制操作系统、库和配置，大幅减少存储空间和其他软件的恶意攻击，同时让应用程序和OS内核都运行在特权态，提高了整体性能。Unikraft的性能和对Linux应用的支持，使得它得到了产业界一定的认可和使用。但Unikraft采用C语言设计实现，这导致了内核组件的重用性和安全性还需提高。
   - 这些组件化操作系统的尝试告诉我们几点：
     - 组件化操作系统致力于增强重用性和可靠性，但决不能忽视性能问题。
     - 使用合适的编程语言十分重要。
2. **使用Rust开发操作系统的尝试**
   - rCore-OS社区